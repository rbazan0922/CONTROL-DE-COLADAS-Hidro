<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men煤 Principal - Sistema de Control</title>
    <link rel="stylesheet" href="../css/menu.css"> 
</head>
<body>
    <div class="main-menu-wrapper">
        <div class="card app-header">
            <div class="header-left-menu">
                <div>
                    <div class="app-title">Sistema de Control de Coladas</div>
                    <div class="app-subtitle" id="usuarioRolLabel">Usuario:</div>
                </div>
            </div>
            <button class="btn-logout" onclick="cerrarSesion()">Cerrar Sesi贸n</button>
        </div>

        <div class="menu-grid" id="menuGrid">
            <!-- CAMBIO AQU: ahora va a menuDocs.html -->
            <a href="menuDocs.html" class="card menu-item">
                <div class="menu-icon icon-add">
                    <span class="menu-icon-text">+</span> 
                </div>
                <div class="menu-label">Agregar Colada</div>
                <div class="menu-description">Crear nuevo registro de colada y proceso.</div>
            </a>

            <a href="buscar.html" class="card menu-item">
                <div class="menu-icon icon-search">
                    <span class="menu-icon-text">Q</span> 
                </div>
                <div class="menu-label">Buscar Registros</div>
                <div class="menu-description">Consultar y visualizar coladas existentes.</div>
            </a>

            <!-- OPCIN PARA AGREGAR USUARIOS (Solo Supervisor) -->
            <div id="menuAgregarUsuarios" class="card menu-item menu-usuarios-hidden" style="display:none;">
                <a href="usuarios.html" class="menu-usuarios-link">
                    <div class="menu-icon icon-users">
                        <span class="menu-icon-text"></span> 
                    </div>
                    <div class="menu-label">Gestionar Usuarios</div>
                    <div class="menu-description">Agregar y asignar roles a usuarios.</div>
                </a>
            </div>
        </div>
    </div>
    <script>
        // Sistema de usuarios local - definir primero
        const USUARIOS_PREDEFINIDOS = [
            {
                id: 1,
                username: 'supervisor',
                password: '123',
                email: 'supervisor@hidrostal.com',
                rol: 'supervisor'
            },
            {
                id: 2,
                username: 'hornero',
                password: '123',
                email: 'hornero@hidrostal.com',
                rol: 'hornero'
            }
        ];

        function inicializarUsuarios() {
            const usuariosGuardados = localStorage.getItem('usuarios-sistema');
            if (!usuariosGuardados) {
                localStorage.setItem('usuarios-sistema', JSON.stringify(USUARIOS_PREDEFINIDOS));
            }
        }

        function obtenerTodosUsuarios() {
            inicializarUsuarios();
            const usuarios = localStorage.getItem('usuarios-sistema');
            return usuarios ? JSON.parse(usuarios) : USUARIOS_PREDEFINIDOS;
        }

        function obtenerUsuarioPorUsername(username) {
            const usuarios = obtenerTodosUsuarios();
            return usuarios.find(u => u.username.toLowerCase() === username.toLowerCase());
        }

        function obtenerUsuarioPorId(id) {
            const usuarios = obtenerTodosUsuarios();
            return usuarios.find(u => u.id === id);
        }

        function crearUsuario(username, email, password, rol) {
            const usuarios = obtenerTodosUsuarios();
            if (usuarios.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                throw new Error('Usuario ya existe');
            }
            if (usuarios.find(u => u.email.toLowerCase() === email.toLowerCase())) {
                throw new Error('Email ya existe');
            }
            const nuevoUsuario = {
                id: Math.max(...usuarios.map(u => u.id), 0) + 1,
                username: username.toLowerCase(),
                email: email.toLowerCase(),
                password: password,
                rol: rol,
                createdAt: new Date().toISOString()
            };
            usuarios.push(nuevoUsuario);
            localStorage.setItem('usuarios-sistema', JSON.stringify(usuarios));
            return nuevoUsuario;
        }

        function cambiarRolUsuario(usuarioId, nuevoRol) {
            const usuarios = obtenerTodosUsuarios();
            const usuario = usuarios.find(u => u.id === usuarioId);
            if (!usuario) throw new Error('Usuario no encontrado');
            usuario.rol = nuevoRol;
            localStorage.setItem('usuarios-sistema', JSON.stringify(usuarios));
            return usuario;
        }

        function eliminarUsuario(usuarioId) {
            const usuarios = obtenerTodosUsuarios();
            const index = usuarios.findIndex(u => u.id === usuarioId);
            if (index === -1) throw new Error('Usuario no encontrado');
            const usuarioEliminado = usuarios[index];
            usuarios.splice(index, 1);
            localStorage.setItem('usuarios-sistema', JSON.stringify(usuarios));
            return usuarioEliminado;
        }

        inicializarUsuarios();

// Funci贸n para cerrar sesi贸n - funciona en TODAS las p谩ginas
function cerrarSesion() {
    // Borramos todo sin dialogs
    localStorage.removeItem("usuarioLogueado");
    localStorage.removeItem("rol");
    localStorage.removeItem("token");
    localStorage.removeItem("usuario");

    // Volvemos al login silenciosamente
    window.location.href = "../index.html";
}

// Mostrar/ocultar opciones seg煤n rol
document.addEventListener('DOMContentLoaded', () => {
    const rol = localStorage.getItem("rol");
    const menuGrid = document.getElementById("menuGrid");
    const appHeader = document.querySelector(".app-header");
    const usuarioRolLabel = document.getElementById("usuarioRolLabel");
    
    // Mostrar opci贸n de agregar usuarios solo para supervisores
    if (rol === "supervisor") {
        const menuUsuarios = document.getElementById("menuAgregarUsuarios");
        // Quitar la clase que lo oculta y asegurar visualizaci贸n
        menuUsuarios.classList.remove("menu-usuarios-hidden");
        menuUsuarios.style.display = "block";
        usuarioRolLabel.textContent = "Usuario: supervisor";
    } else if (rol === "hornero") {
        // Para hornero, centrar los dos botones y hacer header m谩s ancho
        menuGrid.classList.add("hornero-menu");
        appHeader.classList.add("hornero-header");
        usuarioRolLabel.textContent = "Usuario: hornero";
    }
});
</script>
</body>
</html>